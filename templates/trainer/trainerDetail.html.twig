{% extends 'base.html.twig' %}

{% block title %}Profil Formateur{% endblock %}


{% block body %}

    <h1>{{ trainer }}</h1>
    <span class="subtitle">Formateur</span>
    <br>
    {# <a href="{{ path('app_trainer') }}">Retour</a> #}
    <button onclick="history.back()"><i class="fa-solid fa-arrow-left"></i> Retour</button>


    <br><br>

    {# {% if is_granted('ROLE_ADMIN') %} #}
    {% if app.user %}
    
        <h2>Infos</h2>
        <ul>
            <li>Nom: {{ trainer }}</li>
            <li>Sessions Formées: {{ trainerSessionsCount }}</li>
        </ul>



            <h3>En cours</h3>


                    <table id="ongoingSessionsTable" class="display">
                        <thead>
                            <tr>
                                <th>Formation</th>
                                <th>Session</th>
                                <th>Dates</th>
                                <th>Status</th>
                                <th>Inscriptions</th>
                            </tr>
                        </thead>

                        <tbody>

                            {% for trainerSession in inProgressSessionsTrainer %}

                                {# Calcul du pourcentage de places réservés et affichage color fa-user en fonction #}
                                {% if ((trainerSession.nbrOfSubscribers / trainerSession.nbrPlaces ) < 0.5) %}
                                    {% set sessionStatusClass = "open" %}
                                    {% set sessionStatusText = "Ouvert" %}
                                {% elseif ( ((trainerSession.nbrOfSubscribers / trainerSession.nbrPlaces ) >= 0.5) and ((trainerSession.nbrOfSubscribers / trainerSession.nbrPlaces ) < 1) ) %}
                                    {% set sessionStatusClass = "midOpen" %}
                                    {% set sessionStatusText = "Ouvert" %}
                                {% elseif ((trainerSession.nbrOfSubscribers / trainerSession.nbrPlaces ) >= 1) %}
                                    {% set sessionStatusClass = "full" %}
                                    {% set sessionStatusText = "Complet" %}
                                {% endif %}


                                <tr class="clickableTr" value="{{ trainerSession.id }}">
                                    <td class="trainingTitle">{{ trainerSession.training }}</td>
                                    <td>{{ trainerSession|capitalize }}</td>
                                    <td>Du {{ trainerSession.beginDate|date('d-m-Y') }}<br>au {{ trainerSession.endDate|date('d-m-Y') }}</td>
                                    <td class="{{ sessionStatusClass }}">{{ sessionStatusText }}</td>
                                    <td class="{{ sessionStatusClass }}">{{ trainerSession.nbrOfSubscribers }}/{{ trainerSession.nbrPlaces }} <i class="fa-solid fa-user-group"></i></td>
                                </tr>

                            {% endfor %}

                        </tbody>

                    </table>

                    <script>
                        let table = new DataTable('#ongoingSessionsTable', {
                            paging: false,
                            searching: false,
                            "info": false,
                            "language": {
                                "url": "//cdn.datatables.net/plug-ins/1.13.4/i18n/fr-FR.json"
                            }
                            // scrollY: 400
                        });
                    </script>



            <h3>A venir</h3>




                    <table id="incomingSessionsTable" class="display">
                        <thead>
                            <tr>
                                <th>Formation</th>
                                <th>Session</th>
                                <th>Dates</th>
                                <th>Status</th>
                                <th>Inscriptions</th>
                            </tr>
                        </thead>

                        <tbody>

                            {% for trainerSession in incomingSessionsTrainer %}

                                {# Calcul du pourcentage de places réservés et affichage color fa-user en fonction #}
                                {% if ((trainerSession.nbrOfSubscribers / trainerSession.nbrPlaces ) < 0.5) %}
                                    {% set sessionStatusClass = "open" %}
                                    {% set sessionStatusText = "Ouvert" %}
                                {% elseif ( ((trainerSession.nbrOfSubscribers / trainerSession.nbrPlaces ) >= 0.5) and ((trainerSession.nbrOfSubscribers / trainerSession.nbrPlaces ) < 1) ) %}
                                    {% set sessionStatusClass = "midOpen" %}
                                    {% set sessionStatusText = "Ouvert" %}
                                {% elseif ((trainerSession.nbrOfSubscribers / trainerSession.nbrPlaces ) >= 1) %}
                                    {% set sessionStatusClass = "full" %}
                                    {% set sessionStatusText = "Complet" %}
                                {% endif %}


                                <tr class="clickableTr" value="{{ trainerSession.id }}">
                                    <td class="trainingTitle">{{ trainerSession.training }}</td>
                                    <td>{{ trainerSession|capitalize }}</td>
                                    <td>Du {{ trainerSession.beginDate|date('d-m-Y') }}<br>au {{ trainerSession.endDate|date('d-m-Y') }}</td>
                                    <td class="{{ sessionStatusClass }}">{{ sessionStatusText }}</td>
                                    <td class="{{ sessionStatusClass }}">{{ trainerSession.nbrOfSubscribers }}/{{ trainerSession.nbrPlaces }} <i class="fa-solid fa-user-group"></i></td>
                                </tr>

                            {% endfor %}

                        </tbody>

                    </table>

                    <script>
                        let table2 = new DataTable('#incomingSessionsTable', {
                            paging: false,
                            searching: false,
                            "info": false,
                            "language": {
                                "url": "//cdn.datatables.net/plug-ins/1.13.4/i18n/fr-FR.json"
                            }
                            // scrollY: 400
                        });
                    </script>




            <h3>Passées</h3>




                    <table id="passedSessionsTable" class="display">
                        <thead>
                            <tr>
                                <th>Formation</th>
                                <th>Titre</th>
                                <th>Dates</th>
                                <th>Status</th>
                                <th>Inscriptions</th>
                            </tr>
                        </thead>

                        <tbody>

                            {% for trainerSession in passedSessionsTrainer %}

                                {# Calcul du pourcentage de places réservés et affichage color fa-user en fonction #}
                                {% if ((trainerSession.nbrOfSubscribers / trainerSession.nbrPlaces ) < 0.5) %}
                                    {% set sessionStatusClass = "open" %}
                                    {% set sessionStatusText = "Ouvert" %}
                                {% elseif ( ((trainerSession.nbrOfSubscribers / trainerSession.nbrPlaces ) >= 0.5) and ((trainerSession.nbrOfSubscribers / trainerSession.nbrPlaces ) < 1) ) %}
                                    {% set sessionStatusClass = "midOpen" %}
                                    {% set sessionStatusText = "Ouvert" %}
                                {% elseif ((trainerSession.nbrOfSubscribers / trainerSession.nbrPlaces ) >= 1) %}
                                    {% set sessionStatusClass = "full" %}
                                    {% set sessionStatusText = "Complet" %}
                                {% endif %}


                                <tr class="clickableTr" value="{{ trainerSession.id }}">
                                    <td class="trainingTitle maxWidthEllipsis">{{ trainerSession.training }}</td>
                                    <td>{{ trainerSession|capitalize }}</td>
                                    <td>Du {{ trainerSession.beginDate|date('d-m-Y') }}<br>au {{ trainerSession.endDate|date('d-m-Y') }}</td>
                                    <td class="{{ sessionStatusClass }}">{{ sessionStatusText }}</td>
                                    <td class="{{ sessionStatusClass }}">{{ trainerSession.nbrOfSubscribers }}/{{ trainerSession.nbrPlaces }} <i class="fa-solid fa-user-group"></i></td>
                                </tr>

                            {% endfor %}

                        </tbody>

                    </table>

                    <script>
                        let table3 = new DataTable('#passedSessionsTable', {
                            paging: false,
                            searching: false,
                            "info": false,
                            "language": {
                                "url": "//cdn.datatables.net/plug-ins/1.13.4/i18n/fr-FR.json"
                            }
                            // scrollY: 400
                        });
                    </script>




                <script>
                // Rend les <tr> clickables, redirection vers sessionDetail (mais passe par la route et non le nom de la route)
                var clickableTrs = document.querySelectorAll('.clickableTr');
                if(clickableTrs != null) {
                    for (var i = 0; i < clickableTrs.length; i++) {
                        (function(index) {
                            clickableTrs[index].addEventListener('click', function() {

                                var idSessionClicked = clickableTrs[index].getAttribute("value");
                                window.location.href = "/sessionDetail/" + idSessionClicked;

                            });
                        })(i);
                    }
                }
                </script>



    {% else %}

        <p>Vous n'avez pas l'autorisation de voir ces infos</p>

    {% endif %}


    {# {% if is_granted('ROLE_ADMIN') %} #}
    {% if app.user %}
        <a class="editButton" href="{{ path('app_editTrainer', {'id': trainer.id }) }}"><i class="fa-solid fa-pen-to-square"></i> Éditer le formateur</a>
        <a class="deleteButton" href="{{ path('app_deleteTrainer', {'id': trainer.id }) }}"><i class="fa-solid fa-trash-can"></i> Supprimer le formateur</a>
    {% else %}
        <p style="opacity: 0.5">Éditer le formateur (Admin)</p>
    {% endif %}
        


{% endblock %}